import pandas as pd
from config import ECOCROP_PATH

class EcoCropService:
    """–°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π FAO EcoCrop."""
    
    DELETE_COLUMNS = {"AUTH", "FAMNAME"}

    def __init__(self):
        # –ß–∏—Ç–∞–µ–º CSV
        try:
            self.df = pd.read_csv(ECOCROP_PATH, encoding="Windows-1252")
        except FileNotFoundError:
            raise RuntimeError(f"EcoCrop CSV not found at {ECOCROP_PATH}")        # –ü—Ä–∏–≤–æ–¥–∏–º –≤—Å–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
        self.df["ScientificName"] = self.df["ScientificName"].astype(str).str.lower()
        self.df["COMNAME"] = self.df["COMNAME"].astype(str).str.lower()
        
        # –ó–∞–º–µ–Ω—è–µ–º NaN –Ω–∞ None, —á—Ç–æ–±—ã JSON –º–æ–≥ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å
        self.df = self.df.where(pd.notnull(self.df), None)


    def get_crop(self, name: str) -> dict | None:
        """–ò—â–µ—Ç –∫—É–ª—å—Ç—É—Ä—É –ø–æ –Ω–∞—É—á–Ω–æ–º—É –Ω–∞–∑–≤–∞–Ω–∏—é (ScientificName)."""
        if not name:
            return None
        name = name.lower().strip()
        
        crop = self.df[self.df["ScientificName"].str.contains(name, na=False)]
        if crop.empty:
            crop = self.df[self.df["COMNAME"].str.contains(name, na=False)]
            if crop.empty:
                return None
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ —Å–ª–æ–≤–∞—Ä—å –±–µ–∑ NaN
        data = crop.iloc[0].to_dict()
        import pprint
        pprint.pprint(data)

        # –£–±–∏—Ä–∞–µ–º NaN –≤—Ä—É—á–Ω—É—é –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –≥–¥–µ-—Ç–æ –æ—Å—Ç–∞–ª–∏—Å—å
        clean_data = {
            k: (None if pd.isna(v) else v)
            for k, v in data.items()
            if k not in self.DELETE_COLUMNS
        }

        return clean_data
        
        """ # No need
        EcoPortCode - –Ω–æ–º–º–µ—Ä –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑–µ EcoCrop
        AUTH - –ê–≤—Ç–æ—Ä

        FAMNAME - —Ç–∞–∫—Å–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ —Å–µ–º–µ–π—Å—Ç–≤–æ
          
        # –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª
        LIFO - –§–æ—Ä–º–∞ —Ä–æ—Å—Ç–∞ (–¥–µ—Ä–µ–≤–æ, –∫—É—Å—Ç, —Ç—Ä–∞–≤–∞ –∏ —Ç.–¥.)
        HABI - –•–∞—Ä–∞–∫—Ç–µ—Ä —Ä–æ—Å—Ç–∞ (–ø—Ä—è–º–æ—Å—Ç–æ—è—á–∏–π, –≤—å—é—â–∏–π—Å—è –∏ —Ç.–ø.)
        LISPA - –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª (–æ–¥–Ω–æ–ª–µ—Ç–Ω–∏–∫, –º–Ω–æ–≥–æ–ª–µ—Ç–Ω–∏–∫ –∏ —Ç.–¥.)
        PHYS - –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–≤–µ—á–Ω–æ–∑–µ–ª—ë–Ω—ã–π, –æ–¥–∏–Ω–æ—á–Ω—ã–π —Å—Ç–µ–±–µ–ª—å)


        """

        """ # Need
        ScientificName - –ù–∞—É—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
        SYNO - Synonyms, —Å–∏–Ω–æ–Ω–∏–º—ã –Ω–∞—É—á–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è
        COMNAME - Common Name, –Ω–∞—Ä–æ–¥–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
        
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –≤—ã—Ä–∞—â–∏–≤–∞–Ω–∏–µ
        CAT - –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∫—É–ª—å—Ç—É—Ä—ã
        PLAT - –ú–∞—à—Ç–∞–± –≤—ã—Ä–∞—â–∏–≤–∞–Ω–∏—è
        PROSY - –°—Ñ–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
        GMIN / GMAX - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–µ–≥–µ—Ç–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞

        
        # —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
        - TOPMN / TOPMX ‚Äî –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Ä–æ—Å—Ç–∞ (–º–∏–Ω–∏–º—É–º / –º–∞–∫—Å–∏–º—É–º)
        - TMIN / TMAX ‚Äî –ê–±—Å–æ–ª—é—Ç–Ω—ã–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –∫—É–ª—å—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –≤—ã–∂–∏–≤–∞—Ç—å
        - KTMPR / KTMP ‚Äî –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –Ω–∏–∂–µ –∫–æ—Ç–æ—Ä–æ–π —Ä–∞—Å—Ç–µ–Ω–∏–µ –ø–æ–≥–∏–±–∞–µ—Ç (—Ä–µ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∞—è / –≤–µ–≥–µ—Ç–∞—Ç–∏–≤–Ω–∞—è)

        üåßÔ∏è –û—Å–∞–¥–∫–∏
        - ROPMN / ROPMX ‚Äî –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å–∞–¥–∫–æ–≤ –≤ –≥–æ–¥ (–º–º)
        - RMIN / RMAX ‚Äî –î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –æ—Å–∞–¥–∫–æ–≤ (–º–º)

        üß™ pH –ø–æ—á–≤—ã
        - PHOPMN / PHOPMX ‚Äî –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω pH –ø–æ—á–≤—ã
        - PHMIN / PHMAX ‚Äî –î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω pH –ø–æ—á–≤—ã

        üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è
        - LATOPMN / LATOPMX ‚Äî –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–æ—Ç–∞ (–º–∏–Ω–∏–º—É–º / –º–∞–∫—Å–∏–º—É–º)
        - LATMN / LATMX ‚Äî –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω —à–∏—Ä–æ—Ç—ã
        - ALTMX ‚Äî –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –Ω–∞–¥ —É—Ä–æ–≤–Ω–µ–º –º–æ—Ä—è (–º)

        ‚òÄÔ∏è –°–≤–µ—Ç
        - LIOPMN / LIOPMX ‚Äî –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –æ—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç–∏
        - LIMN / LIMX ‚Äî –î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –æ—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç–∏

        üß± –ü–æ—á–≤–∞
        - DEP / DEPR ‚Äî –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è / –¥–æ–ø—É—Å—Ç–∏–º–∞—è –≥–ª—É–±–∏–Ω–∞ –ø–æ—á–≤—ã
        - TEXT / TEXTR ‚Äî –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è / –¥–æ–ø—É—Å—Ç–∏–º–∞—è —Ç–µ–∫—Å—Ç—É—Ä–∞ –ø–æ—á–≤—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª—ë–≥–∫–∞—è, —Å—Ä–µ–¥–Ω—è—è, —Ç—è–∂—ë–ª–∞—è)
        - FER / FERR ‚Äî –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–ª–æ–¥–æ—Ä–æ–¥–∏—é –ø–æ—á–≤—ã (–≤—ã—Å–æ–∫–∏–µ / —É–º–µ—Ä–µ–Ω–Ω—ã–µ)
        - SAL / SALR ‚Äî –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å–æ–ª—ë–Ω–æ—Å—Ç–∏ –ø–æ—á–≤—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∏–∑–∫–∞—è <4 dS/m)
        - DRA / DRAR ‚Äî –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥—Ä–µ–Ω–∞–∂—É –∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å –∑–∞—Å—É—Ö–∏

        ‚ò†Ô∏è –¢–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å
        - TOX / TOXR ‚Äî –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ç–æ–∫—Å–∏—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ)

        üì∏ –§–æ—Ç–æ–ø–µ—Ä–∏–æ–¥
        - PHOTO ‚Äî –¢—Ä–µ–±—É–µ–º–∞—è –¥–ª–∏–Ω–∞ –¥–Ω—è: –∫–æ—Ä–æ—Ç–∫–∏–π (<12 —á), –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π (12‚Äì14 —á), –¥–ª–∏–Ω–Ω—ã–π (>14 —á)

        üå¶Ô∏è –ö–ª–∏–º–∞—Ç
        - CLIZ ‚Äî –ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–æ–Ω—ã –ø–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ö—ë–ø–ø–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Aw ‚Äî —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–π –≤–ª–∞–∂–Ω—ã–π –∏ —Å—É—Ö–æ–π)

        üß¨ –ê–¥–∞–ø—Ç–∞—Ü–∏—è
        - ABITOL ‚Äî –¢–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ –∞–±–∏–æ—Ç–∏—á–µ—Å–∫–∏–º —Å—Ç—Ä–µ—Å—Å–∞–º (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ)
        - ABISUS ‚Äî –û—Å–Ω–æ–≤–Ω–æ–π –∞–±–∏–æ—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä, –≤–ª–∏—è—é—â–∏–π –Ω–∞ –∫—É–ª—å—Ç—É—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–ª–∞–∂–Ω–æ—Å—Ç—å)
        - INTRI ‚Äî –ò—Å—Ç–æ—Ä–∏—è –∏–Ω—Ç—Ä–æ–¥—É–∫—Ü–∏–∏ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ)

        üßë‚Äçüåæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
        - PROSY ‚Äî –°—Ñ–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è: –¥–æ–º–∞—à–Ω–∏–µ —Å–∞–¥—ã, –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞—â–∏–≤–∞–Ω–∏–µ –∏ —Ç.–¥.
        - GMIN / GMAX ‚Äî –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–µ–≥–µ—Ç–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (–≤ –¥–Ω—è—Ö)
        """



# –°–æ–∑–¥–∞—ë–º –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä, —á—Ç–æ–±—ã –Ω–µ —á–∏—Ç–∞—Ç—å CSV –∫–∞–∂–¥—ã–π —Ä–∞–∑
ecocrop_service = EcoCropService()


def get_crop(name: str):
    """–§–∞—Å–∞–¥ –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ FastAPI."""
    return ecocrop_service.get_crop(name)


